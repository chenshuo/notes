<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Changes - Shuo Chen's Notes</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  <link href="../../extra.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Changes";
    var mkdocs_page_input_path = "kernel/changes.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-1220141-6', 'chenshuo.com');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Shuo Chen's Notes</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../bugs/">Bugs</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Kernel</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../data-structures/">Data Structures</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../file-descriptor-table/">File Descriptor Table</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../epoll/">Epoll</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../callgraph/">Call Graphs</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../reuseport/">SO_REUSEPRT</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Changes</a>
    <ul class="current">
    </ul>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Languages</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../lcc/">lcc</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../lua/">Lua</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../git/">Git</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../mem/">Memory Model</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../ssl/">SSL</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../dsp/">DSP</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../links/">Links</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Shuo Chen's Notes</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Kernel &raquo;</li>
        
      
    
    <li>Changes</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="412-2017-07-02">4.12 - 2017-07-02</h1>
<ul>
<li>Removed <code>net.ipv4.tcp_tw_recycle</code> option from Kernel <a href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=4396e46187ca5070219b81773c4e65088dac50cc">commit</a>.
Ref. <a href="https://vincent.bernat.ch/en/blog/2014-tcp-time-wait-state-linux">Coping with the TCP TIME-WAIT state on busy Linux servers</a> by Vincent Bernat.</li>
</ul>
<h1 id="49-2016-12-11">4.9 - 2016-12-11</h1>
<p><a href="https://kernelnewbies.org/Linux_4.9">Linux 4.9</a></p>
<ul>
<li>BBR congestion control algorithm</li>
<li>tcp: use an RB tree for ooo receive queue <a href="https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=9f5afeae51526b3ad7b7cb21ee8b145ce6ea7a7a">commit 9f5afeae51</a></li>
</ul>
<h1 id="46-2016-05-15">4.6 - 2016-05-15</h1>
<p><a href="https://kernelnewbies.org/Linux_4.6">Linux 4.6</a></p>
<ul>
<li>Faster SO_REUSEPORT for TCP</li>
</ul>
<h1 id="45-2016-03-13">4.5 - 2016-03-13</h1>
<p><a href="https://kernelnewbies.org/Linux_4.5">Linux 4.5</a></p>
<ul>
<li>Faster SO_REUSEPORT for UDP</li>
<li><a href="https://lwn.net/Articles/633422">Better epoll multithread scalability</a></li>
</ul>
<h1 id="44-2016-01-10">4.4 - 2016-01-10</h1>
<p><a href="https://kernelnewbies.org/Linux_4.4">Linux 4.4</a></p>
<ul>
<li>TCP scalability<ul>
<li>Lockless TCP listener</li>
<li>SO_INCOMING_CPU</li>
<li>TCP_NEW_SYN_RECV</li>
</ul>
</li>
</ul>
<pre><code class="text">commit ca6fb06518836ef9b65dc0aac02ff97704d52a05
Author: Eric Dumazet &lt;edumazet@google.com&gt;
Date:   Fri Oct 2 11:43:35 2015 -0700

    tcp: attach SYNACK messages to request sockets instead of listener

    If a listen backlog is very big (to avoid syncookies), then
    the listener sk-&gt;sk_wmem_alloc is the main source of false
    sharing, as we need to touch it twice per SYNACK re-transmit
    and TX completion.

    (One SYN packet takes listener lock once, but up to 6 SYNACK
    are generated)

    By attaching the skb to the request socket, we remove this
    source of contention.

    Tested:

     listen(fd, 10485760); // single listener (no SO_REUSEPORT)
     16 RX/TX queue NIC
     Sustain a SYNFLOOD attack of ~320,000 SYN per second,
     Sending ~1,400,000 SYNACK per second.
     Perf profiles now show listener spinlock being next bottleneck.

        20.29%  [kernel]  [k] queued_spin_lock_slowpath
        10.06%  [kernel]  [k] __inet_lookup_established
         5.12%  [kernel]  [k] reqsk_timer_handler
         3.22%  [kernel]  [k] get_next_timer_interrupt
         3.00%  [kernel]  [k] tcp_make_synack
         2.77%  [kernel]  [k] ipt_do_table
         2.70%  [kernel]  [k] run_timer_softirq
         2.50%  [kernel]  [k] ip_finish_output
         2.04%  [kernel]  [k] cascade

    Signed-off-by: Eric Dumazet &lt;edumazet@google.com&gt;
    Signed-off-by: David S. Miller &lt;davem@davemloft.net&gt;
</code></pre>

<pre><code class="text">commit 079096f103faca2dd87342cca6f23d4b34da8871
Author: Eric Dumazet &lt;edumazet@google.com&gt;
Date:   Fri Oct 2 11:43:32 2015 -0700

    tcp/dccp: install syn_recv requests into ehash table

    In this patch, we insert request sockets into TCP/DCCP
    regular ehash table (where ESTABLISHED and TIMEWAIT sockets
    are) instead of using the per listener hash table.

    ACK packets find SYN_RECV pseudo sockets without having
    to find and lock the listener.

    In nominal conditions, this halves pressure on listener lock.

    Note that this will allow for SO_REUSEPORT refinements,
    so that we can select a listener using cpu/numa affinities instead
    of the prior 'consistent hash', since only SYN packets will
    apply this selection logic.

    We will shrink listen_sock in the following patch to ease
    code review.

    Signed-off-by: Eric Dumazet &lt;edumazet@google.com&gt;
    Cc: Ying Cai &lt;ycai@google.com&gt;
    Cc: Willem de Bruijn &lt;willemb@google.com&gt;
    Signed-off-by: David S. Miller &lt;davem@davemloft.net&gt;
</code></pre>

<h1 id="43-2015-11-01">4.3 - 2015-11-01</h1>
<p><a href="https://kernelnewbies.org/Linux_4.3">Linux 4.3</a></p>
<pre><code class="text">commit 9dea5dc921b5f4045a18c63eb92e84dc274d17eb
Author: Andy Lutomirski &lt;luto@kernel.org&gt;
Date:   Tue Jul 14 15:24:24 2015 -0700

    x86/entry/syscalls: Wire up 32-bit direct socket calls

    On x86_64, there's no socketcall syscall; instead all of the
    socket calls are real syscalls.  For 32-bit programs, we're
    stuck offering the socketcall syscall, but it would be nice to
    expose the direct calls as well.  This will enable seccomp to
    filter socket calls (for new userspace only, but that's fine for
    some applications) and it will provide a tiny performance boost.
</code></pre>

<p><a href="https://www.sourceware.org/ml/libc-alpha/2016-02/msg00502.html">glibc 2.23</a> 2016-02-19.
Ubuntu 16.04 supports it, Debian 8 doesn't.</p>
<pre><code class="text">commit e5a5315e2d290fe34e0fb80996c713b8b802dcc9
Author: Joseph Myers &lt;joseph@codesourcery.com&gt;
Date:   Wed Dec 9 20:59:43 2015 +0000

    Use direct socket syscalls for new kernels on i386, m68k, microblaze, sh.

    Now that we have __ASSUME_* macros for direct socket syscalls to use
    them instead of socketcall when they can be assumed to be available on
    socketcall architectures, this patch defines those macros when
    appropriate for i386, m68k, microblaze and sh (for 4.3, 4.3, all
    supported kernels and 2.6.37, respectively; the only use of socketcall
    support on microblaze is it allows accept4 and sendmmsg to be
    supported on a wider range of kernel versions).
</code></pre>

<h1 id="42-2015-08-30">4.2 - 2015-08-30</h1>
<p><a href="https://kernelnewbies.org/Linux_4.2">Linux 4.2</a></p>
<pre><code class="text">commit 90c337da1524863838658078ec34241f45d8394d
Author: Eric Dumazet &lt;edumazet@google.com&gt;
Date:   Sat Jun 6 21:17:57 2015 -0700

    inet: add IP_BIND_ADDRESS_NO_PORT to overcome bind(0) limitations

    When an application needs to force a source IP on an active TCP socket
    it has to use bind(IP, port=x).

    As most applications do not want to deal with already used ports, x is
    often set to 0, meaning the kernel is in charge to find an available
    port.
    But kernel does not know yet if this socket is going to be a listener or
    be connected.
    It has very limited choices (no full knowledge of final 4-tuple for a
    connect())

    With limited ephemeral port range (about 32K ports), it is very easy to
    fill the space.

    This patch adds a new SOL_IP socket option, asking kernel to ignore
    the 0 port provided by application in bind(IP, port=0) and only
    remember the given IP address.

    The port will be automatically chosen at connect() time, in a way
    that allows sharing a source port as long as the 4-tuples are unique.

    This new feature is available for both IPv4 and IPv6 (Thanks Neal)
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../lcc/" class="btn btn-neutral float-right" title="lcc">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../reuseport/" class="btn btn-neutral" title="SO_REUSEPRT"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../reuseport/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../../lcc/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS_HTML" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
