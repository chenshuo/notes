<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Shuo Chen" /><link rel="canonical" href="https://chenshuo.com/notes/tl431/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>TL431 Analysis and Simulation - Shuo Chen's Notes</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "TL431 Analysis and Simulation";
        var mkdocs_page_input_path = "tl431.md";
        var mkdocs_page_url = "/notes/tl431/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-4PL3B2ZGE8"></script>
      <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', "G-4PL3B2ZGE8");
      </script>
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Shuo Chen's Notes
        </a>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../bugs/">Bugs</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Kernel</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../kernel/study/">Study</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../kernel/data-structures/">Data Structures</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../kernel/file-descriptor-table/">File Descriptor Table</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../kernel/epoll/">Epoll</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../kernel/callgraph/">Call Graphs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../kernel/reuseport/">SO_REUSEPRT</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../kernel/profiles/">Profiles</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../kernel/changes/">Changes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../kernel/docs/">Docs</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Languages</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../lcc/">lcc</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../lua/">Lua</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../mem/">Memory Model</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Miscs</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../git/">Git</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ssl/">SSL</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../links/">Links</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Elec</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../dsp/">DSP</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../reed-solomon/">Reed-Solomon</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../UA78L05/">μA78L05 Analysis and Simulation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../LM7805/">LM7805 Analysis and Simulation</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">TL431 Analysis and Simulation</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#bandgap-voltage-reference">Bandgap voltage reference</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#the-internal-schematic">The internal schematic</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#analysis">Analysis</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#calculation">Calculation</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#reference-voltage">Reference voltage</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#error-amplifier">Error amplifier</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#tempco">Tempco</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#feedback">Feedback</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#simulation">Simulation</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#another-schematic-by-ken-shirriff">Another schematic by Ken Shirriff</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#spice-model-by-eugene-dvoskin">SPICE model by Eugene Dvoskin</a>
    </li>
    </ul>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Shuo Chen's Notes</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Elec</li>
      <li class="breadcrumb-item active">TL431 Analysis and Simulation</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="tl431-analysis-and-simulation">TL431 Analysis and Simulation</h1>
<p>By Shuo Chen (chenshuo_at_chenshuo.com)</p>
<p>Latest version: <a href="https://chenshuo.github.io/notes/tl431/">https://chenshuo.github.io/notes/tl431/</a></p>
<p>Comments and discussions: <a href="https://github.com/chenshuo/notes/discussions">https://github.com/chenshuo/notes/discussions</a></p>
<p>Series of analysis &amp; simulation of IC regulator designed in 1970s:</p>
<ol>
<li><a href="https://chenshuo.github.io/notes/UA78L05">μA78L05</a></li>
<li><a href="https://chenshuo.github.io/notes/LM7805">LM7805</a></li>
<li><a href="https://chenshuo.github.io/notes/TL431">TL431</a> &lt;- This page</li>
</ol>
<p>In this post, transistor = BJT, however, base currents are ignored by default.</p>
<h2 id="bandgap-voltage-reference">Bandgap voltage reference</h2>
<p>See "How a bandgap reference works" section in <a href="https://www.righto.com/2014/09/reverse-engineering-counterfeit-7805.html">https://www.righto.com/2014/09/reverse-engineering-counterfeit-7805.html</a></p>
<p>The thermal voltage <script type="math/tex">V_\mathrm{T} = \dfrac{kT}{q}</script> is proportional to absolute temperature (PTAT). <script type="math/tex">V_\mathrm{T} \approx 25.8\mathrm{mV}</script> at room temperature (27°C, or 300K).</p>
<blockquote>
<p>Ref. <a href="https://en.wikipedia.org/wiki/Boltzmann_constant#The_thermal_voltage">https://en.wikipedia.org/wiki/Boltzmann_constant#The_thermal_voltage</a></p>
</blockquote>
<p>
<script type="math/tex">V_\mathrm{T}</script> has a positive temperature coefficient of about 86.2μV/°C.</p>
<blockquote>
<p>
<script type="math/tex">\dfrac{V_\mathrm{T}}{T} = \dfrac{k}{q} = \dfrac{ 1.380649\times 10^{-23}}{1.602176634\times 10^{-19}} \approx 8.62 \times 10^{-5}\mathrm{V/K}</script>
</p>
</blockquote>
<p>Therefore, we usually need <script type="math/tex">10\ln 10 \cdot V_\mathrm{T}\approx 23V_\mathrm{T}</script> to cancel out the tempco of one <script type="math/tex">V_\mathrm{BE}</script>, which normally has a negative tempco about -2mV/°C.</p>
<blockquote>
<p>
<script type="math/tex">10 \ln 10 \times 86.2 \approx 23 \times 86.2 = 1.983\mathrm{mV/°C}</script>
</p>
</blockquote>
<p>The actual tempco of <script type="math/tex">V_\mathrm{BE}</script> is related to <script type="math/tex">V_\mathrm{BE}</script> itself, its first order approximation is <script type="math/tex">\dfrac{V_\mathrm{BE0} - V_\mathrm{g0}}{T_0}</script>, see formula in <a href="https://en.wikipedia.org/wiki/Silicon_bandgap_temperature_sensor">https://en.wikipedia.org/wiki/Silicon_bandgap_temperature_sensor</a></p>
<p><a href="https://en.wikipedia.org/wiki/Bipolar_junction_transistor#Ebers%E2%80%93Moll_model">Ebers–Moll model</a>:
<script type="math/tex">I_\mathrm{E} \approx I_\mathrm{S}\exp \dfrac{V_\mathrm{BE}}{V_\mathrm{T}}</script>, equivalently
<script type="math/tex">V_\mathrm{BE} = V_\mathrm{T}\ln \dfrac{I_\mathrm{E}}{I_\mathrm{S}}</script>.</p>
<p><a href="https://en.wikipedia.org/wiki/Saturation_current">Reverse saturation current</a> <script type="math/tex">I_\mathrm{S}</script> is directly proportional to the emitter-base junction area of a transistor, which we just call the <em>area</em> of the transistor.</p>
<p>If we set different emitter currents of two transistors,
we will get two different <script type="math/tex">V_\mathrm{BE}</script>,
their difference is called <script type="math/tex">\Delta V_\mathrm{BE}</script>,
<script type="math/tex">\Delta V_\mathrm{BE} = V_\mathrm{T}\ln\dfrac{J_1}{J_2}</script>.
<script type="math/tex">J</script> is current density, directly proportional to emitter current <script type="math/tex">I_\mathrm{E}</script>,
 inversely proportional to its area.</p>
<h2 id="the-internal-schematic">The internal schematic</h2>
<p><img alt="TL431" src="../media/tl431a.png" /></p>
<p>Resistor values are taken from official TI datasheet <a href="https://www.ti.com/lit/ds/symlink/tl431.pdf">https://www.ti.com/lit/ds/symlink/tl431.pdf</a>.</p>
<p>The resistor and transistor numbering follows <a href="https://www.audio-perfection.com/voltage-regulators/linear-regulators/accurate-tl431-model-development-analysis-and-evaluation/">SPICE model by Eugene Dvoskin</a>.</p>
<p>Transistor <script type="math/tex">Q_{11}</script> is drawn in dashed lines, as it is off in normal operation mode.
IIUC, it acts like a diode to shutdown the output when <code>Ref</code> is connected to <code>Anode</code>.</p>
<h2 id="analysis">Analysis</h2>
<p>Ignoring base currents, assuming <script type="math/tex">\beta\gg 1</script>.
As we will see in the next section , we can actually estimate that <script type="math/tex">\beta\approx 120</script>.</p>
<p>For the following analysis, we assume area ratio of <script type="math/tex">Q_6:Q_2:Q_3</script> being <script type="math/tex">1:3:6</script>, taken from <a href="https://powersimtof.com/Downloads/Papers/The%20TL431%20in%20loop%20control.pdf">The TL431 in loop control</a> by Christophe Basso.
Eugene Dvoskin's SPICE model (at the end of this page) uses a different ratio (<script type="math/tex">0.5:1.2:2.2</script>) though.</p>
<p><img alt="TL431" src="../media/tl431b.png" /></p>
<blockquote>
<p>To show a larger image, right click and then "Open image in new tab".</p>
</blockquote>
<ol>
<li>There are 11 transistors in total, <script type="math/tex">Q_{11}</script> is normally off, so we need to analyze 10 BJTs only.</li>
<li>It's easy to see that <script type="math/tex">Q_9</script> and <script type="math/tex">Q_{10}</script> form a Darlinton pair, it's the output stage.</li>
<li>It's also easy to recognize that <script type="math/tex">Q_7</script> and <script type="math/tex">Q_8</script> is a <a href="https://en.wikipedia.org/wiki/Current_mirror">current mirror</a>, if we assuming they have the same area. (In Ken Shirriff's schematic below, their areas are different, though.)</li>
<li>The rest of 6 transistors <script type="math/tex">Q_1\dots Q_6</script> are tangled together, let's analyze them in parts.</li>
</ol>
<p><strong>Notation</strong>:</p>
<ul>
<li>
<script type="math/tex">V_\mathrm{BE1}</script> denotes the Base-Emitter junction voltage of transistor <script type="math/tex">Q_1</script>
</li>
<li>
<script type="math/tex">V_\mathrm{Q2B}</script> denotes the base voltage of transistor <script type="math/tex">Q_2</script>.</li>
<li>
<script type="math/tex">V_\mathrm{Q3E}</script> denotes the emitter voltage of transistor <script type="math/tex">Q_3</script>, which is also known as <script type="math/tex">\Delta V_\mathrm{BE}</script>.</li>
<li>It's obvious from the schematic above, <script type="math/tex">V_\mathrm{Q3C} = V_\mathrm{Q5B}</script>.</li>
<li>
<script type="math/tex">I_\mathrm{B6}</script> denotes the base current of transistor <script type="math/tex">Q_6</script>, which equals to currents on <script type="math/tex">R_6</script>, <script type="math/tex">I_\mathrm{R6}</script>.</li>
<li>
<script type="math/tex">V_\mathrm{R3}</script> denotes the voltage across resistor <script type="math/tex">R_3</script>, which is <script type="math/tex">9 \Delta V_\mathrm{BE}</script>, assuming <script type="math/tex">I_\mathrm{C3}\approx I_\mathrm{E3}</script>.</li>
<li>
<script type="math/tex">I_2</script>, <script type="math/tex">I_3</script>, <script type="math/tex">I_1</script> are currents on <script type="math/tex">R_2</script>, <script type="math/tex">R_3</script>, <script type="math/tex">R_4</script>, respectively, <script type="math/tex">I_1 = I_2 + I_3</script> as shown in the full schematic above.</li>
<li>Ignoring base currents, <script type="math/tex">I_2 = I_\mathrm{C2} =  I_\mathrm{E2}</script>, <script type="math/tex">I_3 = I_\mathrm{C3} =  I_\mathrm{E3}</script>, <script type="math/tex">I_1 = I_\mathrm{C1} =  I_\mathrm{E1}</script>.</li>
</ul>
<h2 id="calculation">Calculation</h2>
<h3 id="reference-voltage">Reference voltage</h3>
<p>The reference voltage can be divided into 4 segments, from base of <script type="math/tex">Q_1</script> to ground: <script type="math/tex">V_\mathrm{REF} = V_\mathrm{BE1} + V_\mathrm{R4} + V_\mathrm{R3} + V_\mathrm{BE5}</script>.</p>
<p><strong>First</strong>, we consider <script type="math/tex">Q_2, Q_3</script> and resistors connected to them, it's easy to find <script type="math/tex">I_2 = 3I_3</script>.</p>
<ol>
<li>
<p>Assuming <script type="math/tex">V_\mathrm{BE2}=V_\mathrm{BE5}\approx 0.65\mathrm{V}</script>,
<script type="math/tex">V_\mathrm{R2}=V_\mathrm{R3}</script>.</p>
</li>
<li>
<p>
<script type="math/tex">I_2 R_2 = I_3 R_3</script>, so <script type="math/tex">I_2 = \dfrac{R_3}{R_2}I_3 = 3I_3</script>.</p>
</li>
<li>
<script type="math/tex">\Delta V_\mathrm{BE} = V_\mathrm{BE2} -V_\mathrm{BE3} = V_\mathrm{T}\ln 6\approx 46.3</script>mV, given that the area of <script type="math/tex">Q_3</script> is <script type="math/tex">2\times</script> of <script type="math/tex">Q_2</script>.</li>
<li>
<script type="math/tex">V_\mathrm{R3} = \dfrac{R_3}{R_1}\Delta V_\mathrm{BE} = 9\Delta V_\mathrm{BE}</script>, assuming <script type="math/tex">I_\mathrm{C3}\approx I_\mathrm{E3}</script>.</li>
<li>The current on <script type="math/tex">R_4</script> is <script type="math/tex">I_1 = I_2 + I_3 = 4I_3</script>, so <script type="math/tex">V_\mathrm{R4} = \dfrac{4 R_4}{R_1}\Delta V_\mathrm{BE} = 16.4\Delta V_\mathrm{BE}</script>
</li>
<li>Sum of voltages across <script type="math/tex">R_3</script> and <script type="math/tex">R_4</script> is <script type="math/tex">V_\mathrm{R3} + V_\mathrm{R4} = (9+16.4) \Delta V_\mathrm{BE} = 25.4\Delta V_\mathrm{BE}=25.4\ln 6 V_\mathrm{T}\approx 45.5 V_\mathrm{T}\approx 1.174</script>V.</li>
<li>Tempco of <script type="math/tex">V_\mathrm{R3} + V_\mathrm{R4}</script> is <script type="math/tex">45.5 \times 86.2</script> = 3.922 mV/°C, canceling out negative tempco of <script type="math/tex">V_\mathrm{BE1} + V_\mathrm{BE5}</script>, which is <script type="math/tex">\dfrac{V_\mathrm{BE1} - V_\mathrm{g0}}{T_0} +\dfrac{V_\mathrm{BE5} - V_\mathrm{g0}}{T_0}</script>
</li>
<li>In theory, <script type="math/tex">V_\mathrm{REF} = 2V_\mathrm{g0}</script> when its tempco is zero.</li>
</ol>
<p>
<script type="math/tex">R_4</script> is critical, it controls both <script type="math/tex">V_\mathrm{REF}</script> and its tempco, I guess that's why it shows 3 decimal places in the datasheet (3.28kΩ), while other resistors has only 2.</p>
<p><img alt="TL431" src="../media/tl431dc1.png" /></p>
<p>Estimating <script type="math/tex">\beta</script> for fun. It's rough estimation, so we use rounded values, like 1.2V, instead of 1.174V for  <script type="math/tex">V_\mathrm{R3} + V_\mathrm{R4}</script>.</p>
<ol>
<li>Assuming <script type="math/tex">V_\mathrm{BE1}=V_\mathrm{BE5}=0.65</script>V for now.</li>
<li>Sum of voltages across <script type="math/tex">R_3</script> and <script type="math/tex">R_4</script> is <script type="math/tex">V_\mathrm{REF} - V_\mathrm{BE1}-V_\mathrm{BE5} = 2.5-2\times 0.65 = 1.2\mathrm{V}</script>
</li>
<li>The total resistance across the aforementioned 1.2V is <script type="math/tex">R_4 + R_2/\!/R_3 = 3.2 + 2.4 /\!/ 7.2 = 3.2+1.8 = 5</script>kΩ</li>
<li>The current on <script type="math/tex">R_4</script> is <script type="math/tex">I_1 =  \dfrac{1.2}{5} = 0.24</script>mA, so
<script type="math/tex">I_\mathrm{E1} = 240</script>μA,</li>
<li>The current on <script type="math/tex">R_4</script> is <script type="math/tex">I_1 = I_2 + I_3 = 4I_3</script>, so <script type="math/tex">I_3 = I_1/4 = 60</script>μA, and <script type="math/tex">I_2 = 3I_3 = 180</script>μA.</li>
<li>The datasheet says typical <script type="math/tex">I_\mathrm{REF}=I_\mathrm{B1}=2</script>μA, so we estimate <script type="math/tex">\beta + 1 = I_{E1}/I_\mathrm{B1} = 240/2 = 120</script>.</li>
</ol>
<p>The voltages and currents shown in above schematic are from SPICE simulation.</p>
<h3 id="error-amplifier">Error amplifier</h3>
<p><strong>Second</strong>, we add <script type="math/tex">Q_4\dots Q_8</script> into the picture, omitting <script type="math/tex">Q_9</script> and <script type="math/tex">Q_{10}</script> for now.</p>
<p>It's safe to assume that all <script type="math/tex">Q_4\dots Q_8</script> share the same (emitter) current, because <script type="math/tex">Q_7</script> and <script type="math/tex">Q_8</script> form a current mirror, and it sets the currents of <script type="math/tex">Q_4</script>, <script type="math/tex">Q_5</script>, and <script type="math/tex">Q_6</script> to be all the same.</p>
<p>We will show that the current is 60μA for <script type="math/tex">Q_4\dots Q_8</script>, same as emitter current of <script type="math/tex">Q_3</script>.</p>
<ol>
<li>
<script type="math/tex">V_\mathrm{Q2B} \approx V_\mathrm{Q6B}</script>, because <script type="math/tex">I_\mathrm{B6}</script> is less than 1μA, so voltage drop on <script type="math/tex">R_6</script> is less than 1mV.</li>
<li>Area of <script type="math/tex">Q_6</script> is 1E, area of <script type="math/tex">Q_2</script> is 3E, with the same base voltage, <script type="math/tex">I_\mathrm{E2} = 3 I_\mathrm{E6}</script>
</li>
<li>We already knew that <script type="math/tex">I_\mathrm{E2} = I_2 = 3I_3</script>, so <script type="math/tex">I_3 = I_\mathrm{E6} = I_\mathrm{E3} = 60</script>μA. In other words, <script type="math/tex">Q_6</script> has same current as <script type="math/tex">Q_3</script>.</li>
<li>Due to current mirror made of <script type="math/tex">Q_7</script> and <script type="math/tex">Q_8</script>, <script type="math/tex">Q_4</script> and <script type="math/tex">Q_5</script> mirrors the current of <script type="math/tex">Q_6</script>. (But, see the note below.)</li>
<li>In conclusion, 6 transistors <script type="math/tex">Q_3\dots Q_8</script> all have the same current as <script type="math/tex">Q_3</script>, when balanced, that is <script type="math/tex">I_3=60</script>μA.</li>
</ol>
<p>Although this conclusion matches the simulation of the next section, there is an <strong>unsolved puzzle</strong>: the current mirror of <script type="math/tex">Q_7</script> and <script type="math/tex">Q_8</script> is supposed to copy <script type="math/tex">Q_7</script>'s current to <script type="math/tex">Q_8</script>, but not vice versa.  However, the analysis above assume current of <script type="math/tex">Q_6</script>, <script type="math/tex">I_\mathrm{E6}</script>, is set by <script type="math/tex">V_\mathrm{Q2B}</script>, then mirrored in <script type="math/tex">Q_4</script> and <script type="math/tex">Q_5</script>.
Is this reasonable? My explanation is that the feedback of output stage will bring the circuit into the balanced state, where <script type="math/tex">I_\mathrm{E4} = I_\mathrm{E6}</script>. (<script type="math/tex">I_\mathrm{C6} = I_\mathrm{C8} - I_\mathrm{B9}</script>)</p>
<p>The following diagram shows what we have analyzed so far.</p>
<p><img alt="TL431" src="../media/tl431dc2.png" /></p>
<p>The voltages and currents shown in above schematic are from SPICE simulation.</p>
<h3 id="tempco">Tempco</h3>
<p>Recall that <script type="math/tex">V_\mathrm{REF} = V_\mathrm{BE1} + V_\mathrm{R4} + V_\mathrm{R3} + V_\mathrm{BE5} = 2.495\mathrm{V}</script>.</p>
<ol>
<li>
<p>
<script type="math/tex">V_\mathrm{R3} + V_\mathrm{R4} = (9+16.4) \Delta V_\mathrm{BE} = 25.4\Delta V_\mathrm{BE}=25.4\ln 6 V_\mathrm{T}\approx 45.5 V_\mathrm{T}\approx 1.174\mathrm{V}</script>
</p>
</li>
<li>
<p>
<script type="math/tex"> V_\mathrm{BE1}  +  V_\mathrm{BE5}  = V_\mathrm{REF} - (V_\mathrm{R3} + V_\mathrm{R4}) = 2.495 - 1.174 = 1.321\mathrm{V}</script>
</p>
</li>
<li>
<p>Tempco of <script type="math/tex">V_\mathrm{R3} + V_\mathrm{R4}</script> is <script type="math/tex">45.5 \times 86.2</script> = 3.922 mV/°C</p>
</li>
<li>
<p>Tempco of <script type="math/tex">V_\mathrm{BE1} + V_\mathrm{BE5}</script> is <script type="math/tex">\dfrac{V_\mathrm{BE1} - V_\mathrm{g0}}{T_0} +\dfrac{V_\mathrm{BE5} - V_\mathrm{g0}}{T_0} = \dfrac{V_\mathrm{BE1} + V_\mathrm{BE5} - 2V_\mathrm{g0}}{T_0} = \dfrac{1.321 - 2\times 1.205}{300}=-3.63</script> mV/°C</p>
</li>
<li>
<p>Tempco of  <script type="math/tex">V_\mathrm{REF} = 3.922 - 3.63 = +0.292</script>mV/°C</p>
</li>
</ol>
<p>From this calculation, we concluded that TL431's reference voltage will change 20.44mV when temperature changes from 0°C to 70°C. However TL431 datasheet says it will only change 4mV in this case, which is 5x better than our calculation.</p>
<p>I don't know how does TL431 archive such good tempco when <script type="math/tex">V_\mathrm{REF} = 2.495\mathrm{V}</script>,
because tempco of <script type="math/tex">V_\mathrm{REF}</script> is determined only by itself: <script type="math/tex">\dfrac{\mathrm{d} V_\mathrm{REF}}{\mathrm{d}\, T}=\dfrac{V_\mathrm{REF} -  2V_\mathrm{g0}}{T_0} = 0.085/300=0.283</script>mV/°C.
Unless the chip manufacturer managed to change <script type="math/tex">V_\mathrm{g0}</script>.</p>
<p><strong>Third</strong>, let's calculate the required <script type="math/tex">I_\mathrm{S}</script>, just for fun.</p>
<p>Recall that <script type="math/tex">V_\mathrm{REF} = V_\mathrm{BE1} + V_\mathrm{R4} + V_\mathrm{R3} + V_\mathrm{BE5} = 2.50</script>V, in order to get <script type="math/tex">V_\mathrm{R4} + V_\mathrm{R3} = 1.2</script>V, we need <script type="math/tex">V_\mathrm{BE1} + V_\mathrm{BE5} = 1.3</script>V.</p>
<p>There are at least two ways to achieve that, given that <script type="math/tex">I_\mathrm{E1} \approx 4 I_\mathrm{E5}</script>:</p>
<ol>
<li>Area of <script type="math/tex">Q_1</script> is <script type="math/tex">4\times</script> of <script type="math/tex">Q_5</script>, so <script type="math/tex">V_\mathrm{BE1} = V_\mathrm{BE5} = 0.65</script>V.<ul>
<li>
<script type="math/tex">I_\mathrm{E5}=I_\mathrm{S}\exp\dfrac{V_\mathrm{BE5}}{V_\mathrm{T}}=60</script>μA</li>
<li>
<script type="math/tex">I_\mathrm{S}\exp\dfrac{650}{25.8} = 60\times 10^{-6}</script>
</li>
<li>
<script type="math/tex">I_\mathrm{S} = 0.6865</script>fA, this is for <script type="math/tex">Q_5</script>
</li>
<li>for <script type="math/tex">Q_1</script>, its <script type="math/tex">I_\mathrm{S1} = 4 I_\mathrm{S} = 2.746</script>fA.</li>
</ul>
</li>
<li>Area of <script type="math/tex">Q_1</script> is the same as <script type="math/tex">Q_5</script>,
so <script type="math/tex">V_\mathrm{BE1} = V_\mathrm{BE5} + V_\mathrm{T}\ln 4\approx V_\mathrm{BE5}+35.8</script>mV.<ul>
<li>
<script type="math/tex">V_\mathrm{BE5} = (1300 - 35.8)/2 = 632</script>mV, <script type="math/tex">V_\mathrm{BE1} = 668</script>mV</li>
<li>
<script type="math/tex">I_\mathrm{S}\exp\dfrac{632}{25.8} = 60\times 10^{-6}</script>
</li>
<li>
<script type="math/tex">I_\mathrm{S} = 1.379</script>fA</li>
<li>for <script type="math/tex">Q_1</script>, its <script type="math/tex">I_\mathrm{S1} = I_\mathrm{S} = 1.379</script>fA.</li>
</ul>
</li>
</ol>
<p><img alt="TL431" src="../media/tl431is2.png" /> second way to estimate <script type="math/tex">I_\mathrm{S}</script>.</p>
<p>In the SPICE model, we set <script type="math/tex">I_\mathrm{S} = 1.0</script>fA for NPN transistors.</p>
<h3 id="feedback">Feedback</h3>
<p><strong>Fourth</strong>, the feedback loop.</p>
<p>
<script type="math/tex">Q_1</script> is an emitter follower, <script type="math/tex">Q_4</script> and <script type="math/tex">Q_6</script> is differential pair, current mirror <script type="math/tex">Q_7</script> and <script type="math/tex">Q_8</script> serves as active load, the error amplifier output is collector of <script type="math/tex">Q_8</script>, which feeds into base of <script type="math/tex">Q_9</script>.</p>
<p>If <script type="math/tex">V_\mathrm{REF}</script> increases a tiny bit, we want to increase collector current of <script type="math/tex">Q_{10}</script> by a lot (a few mA per mV), to hopefully bring back <script type="math/tex">V_\mathrm{REF}</script> to its nominal value (2.495V) through the external feedback network (usually two resistors).</p>
<p>The following diagram shows what will happen if <script type="math/tex">V_\mathrm{REF}</script> increases by 1mV.</p>
<p><img alt="TL431" src="../media/tl431dc3.png" /></p>
<p>Explanation:</p>
<ol>
<li>
<script type="math/tex">V_\mathrm{REF}\uparrow\Rightarrow V_\mathrm{Q1B} \uparrow \Rightarrow V_\mathrm{Q1E} \uparrow \Rightarrow V_\mathrm{Q4B} \uparrow</script>
</li>
<li>
<script type="math/tex">I_\mathrm{C4} \propto \exp V_\mathrm{BE4}</script>
</li>
<li>As <script type="math/tex">V_\mathrm{Q4B} \uparrow</script>, <script type="math/tex">I_\mathrm{C4}\uparrow</script>, it drains more current from <script type="math/tex">Q_7</script>. Because <script type="math/tex">Q_8</script> mirrors <script type="math/tex">Q_7</script>, so <script type="math/tex">I_\mathrm{C8}\uparrow</script>.</li>
<li>
<script type="math/tex">I_\mathrm{C2}</script> is almost linear with <script type="math/tex">V_\mathrm{Q1E} </script>, because <script type="math/tex">V_\mathrm{Q2B}\propto \log I_\mathrm{C2}</script>.</li>
<li>
<script type="math/tex">Q_2</script> and <script type="math/tex">Q_6</script> form a current source, <script type="math/tex">I_\mathrm{C6} = \frac{1}{3}I_\mathrm{C2}</script>
</li>
<li>In short, <script type="math/tex">\Delta I_\mathrm{C4} \propto \exp \Delta V_\mathrm{REF}</script>, while <script type="math/tex">\Delta I_\mathrm{C6} \propto \Delta V_\mathrm{REF}</script>
</li>
<li>
<script type="math/tex">I_\mathrm{C6}</script> only goes up linear with <script type="math/tex">\Delta V_\mathrm{REF}</script>, much lower than <script type="math/tex">\Delta I_\mathrm{C8}</script>, the increase of <script type="math/tex">I_\mathrm{C8}</script> mostly feeds into base of <script type="math/tex">Q_9</script>.</li>
<li>
<script type="math/tex">\Delta I_\mathrm{B9}</script> is amplified by <script type="math/tex">Q_9</script> and <script type="math/tex">Q_{10}</script>, increase <script type="math/tex">I_\mathrm{C10}</script> a lot.</li>
<li>The increase of sink current will hopefully bring <script type="math/tex">V_\mathrm{REF}</script> down back.</li>
</ol>
<h2 id="simulation">Simulation</h2>
<p>Simulating the following circuit using NgSpice in Python Jupyter.</p>
<p><img alt="TL431" src="../media/tl431sim1.png" /></p>
<p>SPICE netlist and results are in <a href="https://github.com/chenshuo/notes/blob/master/notebooks/TL431.ipynb">https://github.com/chenshuo/notes/blob/master/notebooks/TL431.ipynb</a>,
view in <a href="https://colab.research.google.com/github/chenshuo/notes/blob/master/notebooks/TL431.ipynb">Google Colab</a>.</p>
<p><img alt="TL431" src="../media/tl431c.png" /></p>
<blockquote>
<p>To show a larger image, right click and then "Open image in new tab".</p>
</blockquote>
<p><strong>Dynamic Impedance</strong></p>
<p>If we sweep the bias current <script type="math/tex">I_\mathrm{KA}</script> from 1mA to 100mA,
   then measure the the output voltage <script type="math/tex">V_\mathrm{out}</script> range,
   we will get the output impedance of this circuit <script type="math/tex">\dfrac{\Delta V_\mathrm{out}}{\Delta I_\mathrm{KA}}\approx\dfrac{14\mathrm{mV}}{100\mathrm{mA}}=0.14\Omega</script>.</p>
<p>It's 0.14Ω from simulation, lower than 0.2Ω as stated in the datasheet.</p>
<p><strong>DC Gain</strong></p>
<p><img alt="TL431" src="../media/tl431dcgain.png" /></p>
<p>It's about 61dB from simulation, higher than 55dB as stated in TI's datasheet.</p>
<h2 id="another-schematic-by-ken-shirriff">Another schematic by Ken Shirriff</h2>
<p><a href="https://www.righto.com/2014/05/reverse-engineering-tl431-most-common.html">https://www.righto.com/2014/05/reverse-engineering-tl431-most-common.html</a></p>
<blockquote>
<p>The resistances on the official schematic above are very different from what can be seen from the die.</p>
</blockquote>
<p>Note: the transistor and resistor numbers in the following schematic match Ken Shirriff's post, don't be confused with results above.</p>
<p><img alt="TL431" src="../media/tl431ken.png" /></p>
<blockquote>
<p>To show a larger image, right click and then "Open image in new tab".</p>
</blockquote>
<p>Here's brief analysis of its DC operating point, ignoring base currents.</p>
<ol>
<li>Assuming <script type="math/tex">V_\mathrm{BE4}\approx V_\mathrm{BE6}\approx 0.65\mathrm{V}</script>
</li>
<li>Voltage drops on <script type="math/tex">R_2</script> and <script type="math/tex">R_3</script> are approx the same. <script type="math/tex">R_2 = R_3</script> and <script type="math/tex">V_\mathrm{R2}\approx V_\mathrm{R3}</script>, so <script type="math/tex">I_2\approx I_3</script>.</li>
<li>
<p>The area ratio of <script type="math/tex">Q_4</script> and <script type="math/tex">Q_5</script> is <script type="math/tex">0.9:7.2</script>, so voltage on <script type="math/tex">R_4</script> is <script type="math/tex">\Delta V_\mathrm{BE} = V_\mathrm{T}\ln \dfrac{7.2}{0.9}= V_\mathrm{T}\ln 8\approx 53.6\mathrm{mV}</script> at room temperature.</p>
</li>
<li>
<p>Assuming for <script type="math/tex">Q_5</script>, its <script type="math/tex">I_\mathrm{C5} = I_\mathrm{E5} = I_3</script>, so voltage on <script type="math/tex">R_3</script> is <script type="math/tex">\dfrac{24}{3.4}\Delta V_\mathrm{BE}</script>
</p>
</li>
<li>
<p>Voltage on <script type="math/tex">R_1</script> is <script type="math/tex">I_1 R_1 = 2 I_3 R_1 = 2 \dfrac{R_1}{R_4}\Delta V_\mathrm{BE} =\dfrac{2\times 25}{3.4} \Delta V_\mathrm{BE}</script>.</p>
</li>
<li>
<p>In total, <script type="math/tex">V_\mathrm{REF} = V_\mathrm{BE6} + V_\mathrm{R3} + V_\mathrm{R1} + V_\mathrm{BE2} = \dfrac{2\times 25 + 24}{3.4} \Delta V_\mathrm{BE} + V_\mathrm{BE6}  + V_\mathrm{BE2} = \dfrac{74}{3.4} \Delta V_\mathrm{BE} + 2V_\mathrm{BE} </script>
</p>
</li>
<li>
<p>The PTAT portion <script type="math/tex">\dfrac{74}{3.4} \Delta V_\mathrm{BE} = 21.765\times\ln 8 V_\mathrm{T} \approx 45.26  V_\mathrm{T}</script>, which should be in right amount to cancel tempco of two <script type="math/tex">V_\mathrm{BE}</script>.</p>
</li>
<li>
<p>Assuming <script type="math/tex">R_1 + R_2/\!/R_3 = 5\mathrm{kΩ}</script>,
so that <script type="math/tex">I_\mathrm{R1}\approx 240</script>μA. With <script type="math/tex">I_\mathrm{REF} = 2</script>μA, we have <script type="math/tex">\beta = 120</script>.</p>
<ul>
<li>
<script type="math/tex">(25+\dfrac{24}{2})R=5000</script>, <script type="math/tex">R = 135Ω</script>
</li>
<li>
<script type="math/tex">R_1=3.38\mathrm{kΩ}</script>
</li>
<li>
<script type="math/tex">R_2=R_3=3.24\mathrm{kΩ}</script>
</li>
<li>
<script type="math/tex">R_4=460\mathrm{Ω}</script>
</li>
</ul>
</li>
<li>
<p>TODO: analyze the current mirror of gain 0.5, made of <script type="math/tex">Q_8</script> and <script type="math/tex">Q_9</script>.</p>
</li>
</ol>
<h2 id="spice-model-by-eugene-dvoskin">SPICE model by Eugene Dvoskin</h2>
<p><a href="https://www.audio-perfection.com/voltage-regulators/linear-regulators/accurate-tl431-model-development-analysis-and-evaluation/">https://www.audio-perfection.com/voltage-regulators/linear-regulators/accurate-tl431-model-development-analysis-and-evaluation/</a></p>
<p>Simulating the following circuit using NgSpice in Python Jupyter.</p>
<p><img alt="TL431" src="../media/tl431ed1.png" /></p>
<p><a href="https://github.com/chenshuo/notes/blob/master/notebooks/AnalogCircuits.ipynb">https://github.com/chenshuo/notes/blob/master/notebooks/AnalogCircuits.ipynb</a>, view in <a href="https://colab.research.google.com/github/chenshuo/notes/blob/master/notebooks/AnalogCircuits.ipynb#scrollTo=e59f94ac-a62b-4332-b1f6-9154db064b26">Google Colab</a>.</p>
<p>Scroll down to "TL431 Regulator" section.</p>
<p><img alt="TL431" src="../media/tl431ed.png" /></p>
<p>The Vref can be tuned to 2.495V by changing R4 to 3.22kΩ.</p>
<p>μA
kΩ</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../LM7805/" class="btn btn-neutral float-left" title="LM7805 Analysis and Simulation"><span class="icon icon-circle-arrow-left"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/chenshuo/notes" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../LM7805/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS_HTML"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
