<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Bugs - Shuo Chen's Notes</title>
        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="..">Shuo Chen's Notes</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li >
                                <a href="..">Home</a>
                            </li>
                            <li class="active">
                                <a href="./">Bugs</a>
                            </li>
                            <li >
                                <a href="../git/">Git</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Kernel <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../kernel/data-structures/">Data Structures</a>
</li>
                                    
<li >
    <a href="../kernel/file-descriptor-table/">File Descriptor Table</a>
</li>
                                    
<li >
    <a href="../kernel/epoll/">Epoll</a>
</li>
                                    
<li >
    <a href="../kernel/callgraph/">Call Graphs</a>
</li>
                                    
<li >
    <a href="../kernel/reuseport/">SO_REUSEPRT</a>
</li>
                                    
<li >
    <a href="../kernel/changes/">Changes</a>
</li>
                                </ul>
                            </li>
                            <li >
                                <a href="../lcc/">lcc</a>
                            </li>
                            <li >
                                <a href="../lua/">Lua</a>
                            </li>
                            <li >
                                <a href="../mem/">mem</a>
                            </li>
                            <li >
                                <a href="../ssl/">SSL</a>
                            </li>
                            <li >
                                <a href="../links/">Links</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li >
                                <a rel="next" href="..">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li >
                                <a rel="prev" href="../git/">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#gcc">GCC</a></li>
            <li><a href="#bug-54812-private-default-destructor-is-public">Bug 54812: private =default destructor is public</a></li>
        <li class="main "><a href="#glibc">Glibc</a></li>
            <li><a href="#strstr3">strstr(3)</a></li>
        <li class="main "><a href="#kernel">Kernel</a></li>
            <li><a href="#write2-not-thread-safe">write(2) not thread-safe</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="gcc">GCC</h1>
<h3 id="bug-54812-private-default-destructor-is-public"><a href="https://gcc.gnu.org/bugzilla/show_bug.cgi?id=54812">Bug 54812</a>: <code>private</code> <code>=default</code> destructor is <code>public</code></h3>
<p>Delete expression doesn't respect access of defaulted destructor</p>
<pre><code class="cpp">struct Base
{
 private:
  ~Base() = default;
};

int main()
{
  Base* p = new Base;
  delete p;
}
</code></pre>

<blockquote>
<p><a href="https://gcc.gnu.org/bugzilla/show_bug.cgi?id=54812#c10">Quote:</a> The bug affects protected destructors too, and they're commonly used for base classes to prevent deletion via pointer-to-base.</p>
</blockquote>
<p>Fixed in 4.9.0, by <a href="https://gcc.gnu.org/viewcvs/gcc?view=revision&amp;revision=203985">r203985</a>.
Test case added by <a href="https://gcc.gnu.org/viewcvs/gcc?view=revision&amp;revision=204057">r204057</a>.</p>
<h1 id="glibc">Glibc</h1>
<h3 id="strstr3"><code>strstr(3)</code></h3>
<p>Since glibc 2.9, strstr(3) may use <a href="http://www-igm.univ-mlv.fr/~lecroq/string/node26.html">Two Way algorithm</a> in some cases, but the impl. had several bugs:</p>
<ul>
<li><a href="https://sourceware.org/bugzilla/show_bug.cgi?id=12092">Bug 12092</a></li>
<li><a href="https://sourceware.org/bugzilla/show_bug.cgi?id=12100">Bug 12100</a></li>
<li><a href="https://sourceware.org/bugzilla/show_bug.cgi?id=14602">Bug 14602</a></li>
<li>More?</li>
</ul>
<h1 id="kernel">Kernel</h1>
<h3 id="write2-not-thread-safe"><code>write(2)</code> not thread-safe</h3>
<p>Fixed in v3.14, released in 2014-03-30. Ubuntu 14.04 has this bug, Debian 8 doesn't.</p>
<pre><code class="text">commit 9c225f2655e36a470c4f58dbbc99244c5fc7f2d4
Author: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Date:   Mon Mar 3 09:36:58 2014 -0800

    vfs: atomic f_pos accesses as per POSIX

    Our write() system call has always been atomic in the sense that you get
    the expected thread-safe contiguous write, but we haven't actually
    guaranteed that concurrent writes are serialized wrt f_pos accesses, so
    threads (or processes) that share a file descriptor and use &quot;write()&quot;
    concurrently would quite likely overwrite each others data.

    This violates POSIX.1-2008/SUSv4 Section XSI 2.9.7 that says:

     &quot;2.9.7 Thread Interactions with Regular File Operations

      All of the following functions shall be atomic with respect to each
      other in the effects specified in POSIX.1-2008 when they operate on
      regular files or symbolic links: [...]&quot;

    and one of the effects is the file position update.

    This unprotected file position behavior is not new behavior, and nobody
    has ever cared.  Until now.  Yongzhi Pan reported unexpected behavior to
    Michael Kerrisk that was due to this.

    This resolves the issue with a f_pos-specific lock that is taken by
    read/write/lseek on file descriptors that may be shared across threads
    or processes.

    Reported-by: Yongzhi Pan &lt;panyongzhi@gmail.com&gt;
    Reported-by: Michael Kerrisk &lt;mtk.manpages@gmail.com&gt;
    Cc: Al Viro &lt;viro@zeniv.linux.org.uk&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
    Signed-off-by: Al Viro &lt;viro@zeniv.linux.org.uk&gt;
</code></pre>

<p><code>$ man 2 write</code></p>
<pre><code class="text">BUGS
       According  to  POSIX.1-2008/SUSv4  Section XSI 2.9.7 (&quot;Thread Interactions
       with Regular File Operations&quot;):

           All of the following functions shall be atomic with  respect  to  each
           other  in  the  effects specified in POSIX.1-2008 when they operate on
           regular files or symbolic links: ...

       Among the APIs subsequently listed are write() and writev(2).   And  among
       the  effects  that  should  be  atomic  across threads (and processes) are
       updates of the file offset.  However, on Linux before version  3.14,  this
       was  not  the  case:  if two processes that share an open file description
       (see open(2)) perform a write() (or writev(2)) at the same time, then  the
       I/O operations were not atomic with respect updating the file offset, with
       the result that the blocks of data  output  by  the  two  processes  might
       (incorrectly) overlap.  This problem was fixed in Linux 3.14.
</code></pre></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS_HTML" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
