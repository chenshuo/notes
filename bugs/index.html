<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Bugs - Shuo Chen's Notes</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  <link href="../extra.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Bugs";
    var mkdocs_page_input_path = "bugs.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-1220141-6', 'chenshuo.com');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Shuo Chen's Notes</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                    </li>
                </ul>
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Bugs</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#gcc">GCC</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#bug-54812-private-default-destructor-is-public">Bug 54812: private =default destructor is public</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#glibc">Glibc</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#strstr3">strstr(3)</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#getpid2-no-longer-caches-pid">getpid(2) no longer caches PID</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#kernel">Kernel</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#write2-not-thread-safe">write(2) not thread-safe</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#java">Java</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#applied-to-string-operands-can-provoke-side-effects">"+=" applied to String operands can provoke side effects</a>
    </li>
        </ul>
    </li>
    </ul>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Kernel</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../kernel/data-structures/">Data Structures</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../kernel/file-descriptor-table/">File Descriptor Table</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../kernel/epoll/">Epoll</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../kernel/callgraph/">Call Graphs</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../kernel/reuseport/">SO_REUSEPRT</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../kernel/changes/">Changes</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../kernel/links/">Links</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Languages</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../lcc/">lcc</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../lua/">Lua</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../git/">Git</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../mem/">Memory Model</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../ssl/">SSL</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../dsp/">DSP</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../links/">Links</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Shuo Chen's Notes</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Bugs</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="interesting-bugs-in-open-source-projects">Interesting bugs in open source projects</h1>
<h2 id="gcc">GCC</h2>
<h3 id="bug-54812-private-default-destructor-is-public"><a href="https://gcc.gnu.org/bugzilla/show_bug.cgi?id=54812">Bug 54812</a>: <code>private</code> <code>=default</code> destructor is <code>public</code></h3>
<p>Delete expression doesn't respect access of defaulted destructor</p>
<pre><code class="cpp">struct Base
{
 private:
  ~Base() = default;
};

int main()
{
  Base* p = new Base;
  delete p;
}
</code></pre>

<blockquote>
<p><a href="https://gcc.gnu.org/bugzilla/show_bug.cgi?id=54812#c10">Quote:</a> <em>The bug affects protected destructors too, and they're commonly used for base classes to prevent deletion via pointer-to-base.</em></p>
</blockquote>
<p>Fixed in 4.9.0, by <a href="https://gcc.gnu.org/viewcvs/gcc?view=revision&amp;revision=203985">r203985</a>.
Test case added by <a href="https://gcc.gnu.org/viewcvs/gcc?view=revision&amp;revision=204057">r204057</a>.</p>
<h2 id="glibc">Glibc</h2>
<h3 id="strstr3"><code>strstr(3)</code></h3>
<p>Since glibc 2.9, strstr(3) may use <a href="http://www-igm.univ-mlv.fr/~lecroq/string/node26.html">Two Way algorithm</a> in some cases, but the impl. had several bugs:</p>
<ul>
<li><a href="https://sourceware.org/bugzilla/show_bug.cgi?id=12092">Bug 12092</a></li>
<li><a href="https://sourceware.org/bugzilla/show_bug.cgi?id=12100">Bug 12100</a></li>
<li><a href="https://sourceware.org/bugzilla/show_bug.cgi?id=14602">Bug 14602</a></li>
<li>More?</li>
</ul>
<h3 id="getpid2-no-longer-caches-pid"><code>getpid(2)</code> no longer caches PID</h3>
<p>Since <a href="https://sourceware.org/glibc/wiki/Release/2.25">glibc 2.25</a>, <code>getpid(2)</code> no longer caches PID,
released on 2017-02-05.  Ubuntu 18.04, Debian 10 and CentOS 8 contain this change.</p>
<blockquote>
<p>Quote from <a href="https://man7.org/linux/man-pages/man2/getpid.2.html"><code>man 2 getpid</code></a>:
    <em>From glibc version 2.3.4 up to and including version 2.24, the glibc wrapper function for getpid() cached PIDs,
    with the goal of avoiding additional system calls when a process calls getpid() repeatedly.
    ...</em></p>
<p><em>Because of the aforementioned problems, since glibc version 2.25, the PID cache is removed:
    calls to getpid() always invoke the actual system call, rather than returning a cached value.</em></p>
</blockquote>
<h2 id="kernel">Kernel</h2>
<h3 id="write2-not-thread-safe"><code>write(2)</code> not thread-safe</h3>
<p>Fixed in v3.14, released in 2014-03-30. Ubuntu 14.04 has this bug, Debian 8 doesn't.</p>
<pre><code class="text">commit 9c225f2655e36a470c4f58dbbc99244c5fc7f2d4
Author: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Date:   Mon Mar 3 09:36:58 2014 -0800

    vfs: atomic f_pos accesses as per POSIX

    Our write() system call has always been atomic in the sense that you get
    the expected thread-safe contiguous write, but we haven't actually
    guaranteed that concurrent writes are serialized wrt f_pos accesses, so
    threads (or processes) that share a file descriptor and use &quot;write()&quot;
    concurrently would quite likely overwrite each others data.

    This violates POSIX.1-2008/SUSv4 Section XSI 2.9.7 that says:

     &quot;2.9.7 Thread Interactions with Regular File Operations

      All of the following functions shall be atomic with respect to each
      other in the effects specified in POSIX.1-2008 when they operate on
      regular files or symbolic links: [...]&quot;

    and one of the effects is the file position update.

    This unprotected file position behavior is not new behavior, and nobody
    has ever cared.  Until now.  Yongzhi Pan reported unexpected behavior to
    Michael Kerrisk that was due to this.

    This resolves the issue with a f_pos-specific lock that is taken by
    read/write/lseek on file descriptors that may be shared across threads
    or processes.

    Reported-by: Yongzhi Pan &lt;panyongzhi@gmail.com&gt;
    Reported-by: Michael Kerrisk &lt;mtk.manpages@gmail.com&gt;
    Cc: Al Viro &lt;viro@zeniv.linux.org.uk&gt;
    Signed-off-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
    Signed-off-by: Al Viro &lt;viro@zeniv.linux.org.uk&gt;
</code></pre>

<p><code>$ man 2 write</code></p>
<pre><code class="text">BUGS
       According  to  POSIX.1-2008/SUSv4  Section XSI 2.9.7 (&quot;Thread Interactions
       with Regular File Operations&quot;):

           All of the following functions shall be atomic with  respect  to  each
           other  in  the  effects specified in POSIX.1-2008 when they operate on
           regular files or symbolic links: ...

       Among the APIs subsequently listed are write() and writev(2).   And  among
       the  effects  that  should  be  atomic  across threads (and processes) are
       updates of the file offset.  However, on Linux before version  3.14,  this
       was  not  the  case:  if two processes that share an open file description
       (see open(2)) perform a write() (or writev(2)) at the same time, then  the
       I/O operations were not atomic with respect updating the file offset, with
       the result that the blocks of data  output  by  the  two  processes  might
       (incorrectly) overlap.  This problem was fixed in Linux 3.14.
</code></pre>

<h2 id="java">Java</h2>
<h3 id="applied-to-string-operands-can-provoke-side-effects"><a href="https://bugs.openjdk.java.net/browse/JDK-8204322">"+=" applied to String operands can provoke side effects</a></h3>
<p>Introduced in JDK9, fixed in JDK10 but not JDK9.</p>
<p><a href="https://stackoverflow.com/questions/50683786/why-does-arrayidx-a-increase-idx-once-in-java-8-but-twice-in-java-9-and-1">Why does array[idx++]+=“a” increase idx once in Java 8 but twice in Java 9 and 10?</a></p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../kernel/data-structures/" class="btn btn-neutral float-right" title="Data Structures">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href=".." class="btn btn-neutral" title="Home"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href=".." style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../kernel/data-structures/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS_HTML" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
