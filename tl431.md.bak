# TL431

Comments and discussions: <https://github.com/chenshuo/notes/discussions>

## Bandgap voltage reference

See "How a bandgap reference works" section in <https://www.righto.com/2014/09/reverse-engineering-counterfeit-7805.html>

The thermal voltage \(V_\mathrm{T} = \dfrac{kT}{q} \approx 25.8\mathrm{mV}\) at room temperature (27°C, or 300K).

> Ref. <https://en.wikipedia.org/wiki/Boltzmann_constant#The_thermal_voltage>

\(V_\mathrm{T}\) has a positive temperature coefficient of about 86.2μV/°C.

> \(\dfrac{V_\mathrm{T}}{T} = \dfrac{k}{q} = \dfrac{ 1.380649\times 10^{-23}}{1.602176634\times 10^{-19}} \approx 8.62 \times 10^{-5}\mathrm{V/K}\)

Therefore, we usually need \(10\ln 10 \cdot V_\mathrm{T}\approx 23V_\mathrm{T}\) to cancel out the tempco of one \(V_\mathrm{BE}\), which normally has a negative tempco about -2mV/°C.

> \(10 \ln 10 \times 86.2 \approx 23 \times 86.2 = 1.983\mathrm{mV/°C}\)

The actual tempco of \(V_\mathrm{BE}\) is related to \(V_\mathrm{BE}\) itself, see formula in <https://en.wikipedia.org/wiki/Silicon_bandgap_temperature_sensor>

## The internal schematic

![TL431](media/tl431a.png)

Resistors are taken from official TI datasheet <https://www.ti.com/lit/ds/symlink/tl431.pdf>.

The resistor and transistor numbering follows [SPICE model by Eugene Dvoskin](https://www.audio-perfection.com/voltage-regulators/linear-regulators/accurate-tl431-model-development-analysis-and-evaluation/).

Transistor \(Q_{11}\) is drawn in dashed lines, as it is off in normal operation mode.
IIUC, it acts like a diode to shutdown the output when `Ref` is connected to `Anode`.

## Analysis

Ignoring base currents, assuming \(\beta\gg 1\).
As we will see in the next section , we can acturally estimate that \(\beta\approx 120\).

For the following analysis, we assume area ratio of \(Q_6:Q_2:Q_3\) being \(1:3:6\), taken from [The TL431 in loop control](https://powersimtof.com/Downloads/Papers/The%20TL431%20in%20loop%20control.pdf) by Christophe Basso.
Eugene Dvoskin's SPICE model (at the end of this page) uses a different rasio (\(0.5:1.2:2.2\)) though.

![TL431](media/tl431b.png)

1. There are 11 transistors in total, \(Q_{11}\) is normally off, so we need to analyse 10 BJTs.
1. It's easy to see that \(Q_9\) and \(Q_{10}\) form a Darlinton pair, it's the output stage.
1. It's also wasy to recongnize that

## Calculation

The voltages and currents are from SPICE simulation.

![TL431](media/tl431dc1.png)

![TL431](media/tl431dc2.png)

## Simulation

TODO: set up

![TL431](media/tl431c.png)


## Another schematic by Ken Shirriff

<https://www.righto.com/2014/05/reverse-engineering-tl431-most-common.html>

Note: the transistor and resistor numbers in the following schematic match Ken Shirriff's post, don't be confused.

![TL431](media/tl431ken.png)

> The resistances on the official schematic are very different from what can be seen from the die.

Here's beief analysis of its DC operating point:

1. \(\Delta V_\mathrm{BE} = V_\mathrm{T}\ln 8\approx 53.6\mathrm{mV}\)

## SPICE model by Eugene Dvoskin

<https://www.audio-perfection.com/voltage-regulators/linear-regulators/accurate-tl431-model-development-analysis-and-evaluation/>

TODO: set up

![TL431](media/tl431ed.png)

The Vref can be tuned to 2.495V by changing R4 to 3.22kΩ.
